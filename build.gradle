plugins {
	id "java"
	id("org.springframework.boot") version ("2.6.4")
	id("io.spring.dependency-management") version ("1.0.11.RELEASE")
	id("au.com.dius.pact") version "4.3.2"
	id("com.github.davidmc24.gradle.plugin.avro") version ("1.2.0")
}

group = 'com.happymoney.webhook_domain_events_consumer'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '11'

repositories {
	mavenLocal()
	mavenCentral()
	maven {
		url = "https://packages.confluent.io/maven/"
	}
	maven {
		url = uri("https://happymoney-730502903637.d.codeartifact.us-east-1.amazonaws.com/maven/main/")
		credentials {
			username = "aws"
			password = "eyJ2ZXIiOjEsImlzdSI6MTY2ODY2MjI4MCwiZW5jIjoiQTEyOEdDTSIsInRhZyI6IjBuOGx0NHoyemZVX2Q0ZkVIamZwRXciLCJleHAiOjE2Njg3MDU0ODAsImFsZyI6IkExMjhHQ01LVyIsIml2IjoiMXJubGFmUTNlSmZTU1NXWiJ9.mg8wBduXS6WVctp0Y4zlyQ.g9b7Kq_xxFqfsJP6.AiQRr9bmfblz_hw9v3Sxw5vJyp4G2JSod4Zi71PMZs_mmjkWAos0Bf0nYLUXF2Uc79A43kDySf81arYRKDY6-YxixZwEuo-twBseJLNIiGmLUBvbzcWj15pUOg2pku0DX0lbvEXxNxJaX-SZTnTZvMiT7--yhJjf3mEuQod6NiJ6AchOpOUDZSY88oduwNm32wgRAEe_2wSZyP9cvIah0FobAVBb8kP53jjTyLpbmA9aUBdixc8ITIiSz-L-Ryw7KTSBA76Cpfj2pIBSUB0hrufyZwbKY1nTdxJ-B8-VInEZeCtBb4xkG3W95xuw8urQpMvT2PQeGcLBHgoq8-g-rghPASR-BRzXJsAeiu-XnOIFjOLJ6aU9GiZN4qnODSJbfyjjxRgjYsNjWH1Ko5OrXjjiKxE0Axibs_QDE9koDG1MZ0Raxk_1rTDsIXnHXMhQRrvzyZA4I92988eF446rgCbgsnB39UYs5qvxX0HrmX3yEjiFO7Zia8D7ZsWsepTd4ibuOZ-fj-M_HGTfN9GgiCDf4q31K2AMGfT_Rvbw3Xe08M_nTsqRIsdfqJj5wJnkJJDjCvJOvUwCbDJV9Dg5k3N_2V5qZqpDVO9bHx7Mb8wZzL8reNZYw9m93EP4VOem_Z58d2r-ovlA1IiSRplS5OdUX2pDbiDR4kv3YUwo-jX2DeZpzcEjlE_Ehp32Gt2zZr3ppyumsjS1KQltFZyiNBWRroDgpF3OrGRnN5kE7M0s0fceYiymc6wUuDdE5mO6Emub_diabjsmxtay8n84OagzOqiRm6sHCi3h9yXClpJs3Xza8fWYeFw4QWabtKKcEK9HCnxCtvFBUu3edX5BntqsuNuIJ0u8Sasjy1jdUxhiAZMMJkvexQTPxokOsZi2IvWTd6ejXxJIRkpksh-WybtYY9QQvcSW2Pzo9p7WhAmJsuDccYYzS-GfzjKaLwYE8TzlWgfErw5G6f0PqOY09oknJY-FOcU5L81BhSwiIJdFjyrEdn2CMwvw6iM341M3aW1skNF3tRy2wcmK56AT9Nf1eaipM2nwx80vmjZv1SZtu4MELa966hNsRJAS536JAXIbvX70q8x6aBSu4M5s85I0u9xFQmR-m5vz0uKKghf2xdaYFkdT4v4sPuh94VN9wdhyID7Tv3_JM1rXywTHb9x4fTSiCa11vetyubNU9o2XHD4fU4Ygwhhj9Kv5slXYI09z2jZ1DA4hvo_w2BWPTe9Pzli1ONdZgc1nOwWJpA8Wf_OIoLBiyKsi3bkHreZ-ivCpQ1FGHtDOCNqGK0n_6upST1eVBWAfog.ZJYK0m8__px9tdGFQXjefA"
		}
	}
}

dependencies {
	implementation("org.springframework.boot:spring-boot-starter")
	implementation("org.seleniumhq.selenium:selenium-java:3.141.59")
	implementation("org.springframework.kafka:spring-kafka")

	testImplementation("org.junit.jupiter:junit-jupiter:5.8.2")
	testImplementation("org.testcontainers:testcontainers:1.17.3")
	testImplementation("org.testcontainers:junit-jupiter:1.17.3")
	testImplementation("org.springframework.boot:spring-boot-starter-test")
	testImplementation("org.testcontainers:kafka:1.17.3")
	testImplementation("org.springframework.kafka:spring-kafka-test")
	testImplementation("io.github.bonigarcia:webdrivermanager:5.2.3")

	testImplementation("au.com.dius.pact.provider:junit5spring:4.3.12")
	testImplementation("au.com.dius.pact.consumer:junit5:4.3.12")
	testImplementation(files("/Users/jysa/Documents/poc/domain-events-consumer/src/test/resources/app-plain.jar"))
	implementation("org.apache.avro:avro:1.10.0")
	implementation("io.confluent:kafka-avro-serializer:6.2.0")
}

tasks.named('test') {
	useJUnitPlatform()
}

// For canideploy
pact {
	broker {
		pactBrokerUrl = "https://happymoney.pactflow.io"
		pactBrokerToken = System.getenv("PACT_BROKER_TOKEN")
	}
}

// For pactPublish
pact {
	publish {
		pactDirectory = "app/build/pacts"
		pactBrokerUrl = "https://happymoney.pactflow.io"
		pactBrokerToken = System.getenv("PACT_BROKER_TOKEN")
		tags = listOf("domain-events-consumer")
		consumerVersion = "0.0.1-SNAPSHOT"
	}
}
